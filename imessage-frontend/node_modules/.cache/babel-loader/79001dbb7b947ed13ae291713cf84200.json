{"ast":null,"code":"import _slicedToArray from\"/Users/shoumikh/Documents/React-projects/imessage-clone/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from\"react\";import\"./Chat.css\";import MicIcon from\"@material-ui/icons/Mic\";import{IconButton}from\"@material-ui/core\";import Message from\"./Message\";import db from\"./firebase\";import{useSelector}from\"react-redux\";import{selectChatId,selectChatName}from\"./features/chatSlice\";import firebase from\"firebase\";import{selectUser}from\"./features/userSlice\";import FlipMove from\"react-flip-move\";import\"emoji-mart/css/emoji-mart.css\";import{Picker}from\"emoji-mart\";import InsertEmoticonIcon from\"@material-ui/icons/InsertEmoticon\";function Chat(){var _useState=useState(),_useState2=_slicedToArray(_useState,2),input=_useState2[0],setInput=_useState2[1];//takes what msg user enters\nvar _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),messages=_useState4[0],setMessages=_useState4[1];//local state array for messages\nvar chatName=useSelector(selectChatName);//seclects chat name from chat slice\nvar chatId=useSelector(selectChatId);//selects chat Id from chat slice\nvar user=useSelector(selectUser);var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),emojiSwitch=_useState6[0],setEmojiSwitch=_useState6[1];//only triggers when chatId changes\n//for setting msg to database and listen\n//for any changes in the messages state\nuseEffect(function(){//if there is a chatID\n//it will go to chats db which is previously created\n//grab the chatId from chats db\n//as we click on the chat room chatId changes and useEffect\n//loads based on chatId changes\n//it will create db based on chat id\n//create message db and order it by timestamp desc\n//then on any chages inside the message db\n//it will store it message array state\n//the id of the msg in db and data\nif(chatId){db.collection(\"chats\").doc(chatId).collection(\"messages\").orderBy(\"timestamp\",\"desc\").onSnapshot(function(snapshot){setMessages(snapshot.docs.map(function(doc){return{id:doc.id,data:doc.data()};}));});}},[chatId]);//fires in whenever user hits enter after typing a message\nvar sendMessage=function sendMessage(e){var _firebase$firestore;e.preventDefault();//prevents from reloading the page\n//firebase works\n//tells to go to the collection of chats in firebase db\n//then go to based on current chatId\n//for that particular chatId goto the db of messages\n//then add column\ndb.collection(\"chats\").doc(chatId).collection(\"messages\").add({//this provides the time of actual server where is no problem for different country time\ntimestamp:(_firebase$firestore=firebase.firestore)===null||_firebase$firestore===void 0?void 0:_firebase$firestore.FieldValue.serverTimestamp(),message:input,//collected from input state\n//all 4 below are colleted from user slice redux\nuid:user.uid,photo:user.photo,displayName:user.displayName,email:user.email});setInput(\"\");//set the input to nothing after sending message\n};//emoji api function\nvar addEmoji=function addEmoji(e){var emoji=e.native;setInput(input+emoji);};return/*#__PURE__*/React.createElement(\"div\",{className:\"chat\"},/*#__PURE__*/React.createElement(\"div\",{className:\"chat__header\"},/*#__PURE__*/React.createElement(\"h4\",null,\"To: \",/*#__PURE__*/React.createElement(\"span\",{className:\"chat__channelName\"},chatName)),/*#__PURE__*/React.createElement(\"strong\",null,\"Details\")),/*#__PURE__*/React.createElement(\"div\",{className:\"chat__messages\"},/*#__PURE__*/React.createElement(FlipMove,{className:\"chat__flipMove\"},messages.map(function(_ref){var id=_ref.id,data=_ref.data;return/*#__PURE__*/React.createElement(Message,{key:id,contents:data});}))),/*#__PURE__*/React.createElement(\"div\",{className:\"chat__input\"},/*#__PURE__*/React.createElement(\"form\",null,/*#__PURE__*/React.createElement(\"input\",{value:input,onChange:function onChange(e){setInput(e.target.value);},placeholder:\"iMessage\",type:\"text\"}),/*#__PURE__*/React.createElement(\"button\",{onClick:sendMessage},\"Send Message\")),/*#__PURE__*/React.createElement(IconButton,{onClick:function onClick(){setEmojiSwitch(!emojiSwitch);}},/*#__PURE__*/React.createElement(InsertEmoticonIcon,null)),emojiSwitch?/*#__PURE__*/React.createElement(\"span\",{className:\"chat__inputEmojiPicker\"},/*#__PURE__*/React.createElement(Picker,{onSelect:addEmoji})):\"\",/*#__PURE__*/React.createElement(IconButton,null,/*#__PURE__*/React.createElement(MicIcon,{className:\"chat__mic\"}))));}export default Chat;","map":{"version":3,"sources":["/Users/shoumikh/Documents/React-projects/imessage-clone/src/Chat.js"],"names":["React","useEffect","useState","MicIcon","IconButton","Message","db","useSelector","selectChatId","selectChatName","firebase","selectUser","FlipMove","Picker","InsertEmoticonIcon","Chat","input","setInput","messages","setMessages","chatName","chatId","user","emojiSwitch","setEmojiSwitch","collection","doc","orderBy","onSnapshot","snapshot","docs","map","id","data","sendMessage","e","preventDefault","add","timestamp","firestore","FieldValue","serverTimestamp","message","uid","photo","displayName","email","addEmoji","emoji","native","target","value"],"mappings":"8KAAA,MAAOA,CAAAA,KAAP,EAAgBC,SAAhB,CAA2BC,QAA3B,KAA2C,OAA3C,CACA,MAAO,YAAP,CACA,MAAOC,CAAAA,OAAP,KAAoB,wBAApB,CACA,OAASC,UAAT,KAA2B,mBAA3B,CACA,MAAOC,CAAAA,OAAP,KAAoB,WAApB,CACA,MAAOC,CAAAA,EAAP,KAAe,YAAf,CACA,OAASC,WAAT,KAA4B,aAA5B,CACA,OAASC,YAAT,CAAuBC,cAAvB,KAA6C,sBAA7C,CACA,MAAOC,CAAAA,QAAP,KAAqB,UAArB,CACA,OAASC,UAAT,KAA2B,sBAA3B,CACA,MAAOC,CAAAA,QAAP,KAAqB,iBAArB,CACA,MAAO,+BAAP,CACA,OAASC,MAAT,KAAuB,YAAvB,CACA,MAAOC,CAAAA,kBAAP,KAA+B,mCAA/B,CAEA,QAASC,CAAAA,IAAT,EAAgB,eACYb,QAAQ,EADpB,wCACPc,KADO,eACAC,QADA,eACwB;AADxB,eAEkBf,QAAQ,CAAC,EAAD,CAF1B,yCAEPgB,QAFO,eAEGC,WAFH,eAEgC;AAC9C,GAAMC,CAAAA,QAAQ,CAAGb,WAAW,CAACE,cAAD,CAA5B,CAA8C;AAC9C,GAAMY,CAAAA,MAAM,CAAGd,WAAW,CAACC,YAAD,CAA1B,CAA0C;AAC1C,GAAMc,CAAAA,IAAI,CAAGf,WAAW,CAACI,UAAD,CAAxB,CALc,eAMsBT,QAAQ,CAAC,KAAD,CAN9B,yCAMTqB,WANS,eAMIC,cANJ,eAQd;AACA;AACA;AACAvB,SAAS,CAAC,UAAM,CACd;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAIoB,MAAJ,CAAY,CACVf,EAAE,CAACmB,UAAH,CAAc,OAAd,EACGC,GADH,CACOL,MADP,EAEGI,UAFH,CAEc,UAFd,EAGGE,OAHH,CAGW,WAHX,CAGwB,MAHxB,EAIGC,UAJH,CAIc,SAACC,QAAD,CAAc,CACxBV,WAAW,CACTU,QAAQ,CAACC,IAAT,CAAcC,GAAd,CAAkB,SAACL,GAAD,QAAU,CAC1BM,EAAE,CAAEN,GAAG,CAACM,EADkB,CAE1BC,IAAI,CAAEP,GAAG,CAACO,IAAJ,EAFoB,CAAV,EAAlB,CADS,CAAX,CAMD,CAXH,EAYD,CACF,CAzBQ,CAyBN,CAACZ,MAAD,CAzBM,CAAT,CA2BA;AACA,GAAMa,CAAAA,WAAW,CAAG,QAAdA,CAAAA,WAAc,CAACC,CAAD,CAAO,yBACzBA,CAAC,CAACC,cAAF,GAAoB;AACpB;AACA;AACA;AACA;AACA;AACA9B,EAAE,CAACmB,UAAH,CAAc,OAAd,EAAuBC,GAAvB,CAA2BL,MAA3B,EAAmCI,UAAnC,CAA8C,UAA9C,EAA0DY,GAA1D,CAA8D,CAC5D;AACAC,SAAS,sBAAE5B,QAAQ,CAAC6B,SAAX,8CAAE,oBAAoBC,UAApB,CAA+BC,eAA/B,EAFiD,CAG5DC,OAAO,CAAE1B,KAHmD,CAG5C;AAChB;AACA2B,GAAG,CAAErB,IAAI,CAACqB,GALkD,CAM5DC,KAAK,CAAEtB,IAAI,CAACsB,KANgD,CAO5DC,WAAW,CAAEvB,IAAI,CAACuB,WAP0C,CAQ5DC,KAAK,CAAExB,IAAI,CAACwB,KARgD,CAA9D,EAWA7B,QAAQ,CAAC,EAAD,CAAR,CAAc;AACf,CAnBD,CAqBA;AACA,GAAM8B,CAAAA,QAAQ,CAAG,QAAXA,CAAAA,QAAW,CAACZ,CAAD,CAAO,CACtB,GAAIa,CAAAA,KAAK,CAAGb,CAAC,CAACc,MAAd,CACAhC,QAAQ,CAACD,KAAK,CAAGgC,KAAT,CAAR,CACD,CAHD,CAKA,mBACE,2BAAK,SAAS,CAAC,MAAf,eAEE,2BAAK,SAAS,CAAC,cAAf,eACE,kDACM,4BAAM,SAAS,CAAC,mBAAhB,EAAqC5B,QAArC,CADN,CADF,cAIE,4CAJF,CAFF,cAUE,2BAAK,SAAS,CAAC,gBAAf,eACE,oBAAC,QAAD,EAAU,SAAS,CAAC,gBAApB,EACGF,QAAQ,CAACa,GAAT,CAAa,kBAAGC,CAAAA,EAAH,MAAGA,EAAH,CAAOC,IAAP,MAAOA,IAAP,oBACZ,oBAAC,OAAD,EAAS,GAAG,CAAED,EAAd,CAAkB,QAAQ,CAAEC,IAA5B,EADY,EAAb,CADH,CADF,CAVF,cAmBE,2BAAK,SAAS,CAAC,aAAf,eACE,6CACE,6BACE,KAAK,CAAEjB,KADT,CAEE,QAAQ,CAAE,kBAACmB,CAAD,CAAO,CACflB,QAAQ,CAACkB,CAAC,CAACe,MAAF,CAASC,KAAV,CAAR,CACD,CAJH,CAKE,WAAW,CAAC,UALd,CAME,IAAI,CAAC,MANP,EADF,cASE,8BAAQ,OAAO,CAAEjB,WAAjB,iBATF,CADF,cAYE,oBAAC,UAAD,EACE,OAAO,CAAE,kBAAM,CACbV,cAAc,CAAC,CAACD,WAAF,CAAd,CACD,CAHH,eAKE,oBAAC,kBAAD,MALF,CAZF,CAoBGA,WAAW,cACV,4BAAM,SAAS,CAAC,wBAAhB,eACE,oBAAC,MAAD,EAAQ,QAAQ,CAAEwB,QAAlB,EADF,CADU,CAKV,EAzBJ,cA4BE,oBAAC,UAAD,mBACE,oBAAC,OAAD,EAAS,SAAS,CAAC,WAAnB,EADF,CA5BF,CAnBF,CADF,CAsDD,CAED,cAAehC,CAAAA,IAAf","sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport \"./Chat.css\";\nimport MicIcon from \"@material-ui/icons/Mic\";\nimport { IconButton } from \"@material-ui/core\";\nimport Message from \"./Message\";\nimport db from \"./firebase\";\nimport { useSelector } from \"react-redux\";\nimport { selectChatId, selectChatName } from \"./features/chatSlice\";\nimport firebase from \"firebase\";\nimport { selectUser } from \"./features/userSlice\";\nimport FlipMove from \"react-flip-move\";\nimport \"emoji-mart/css/emoji-mart.css\";\nimport { Picker } from \"emoji-mart\";\nimport InsertEmoticonIcon from \"@material-ui/icons/InsertEmoticon\";\n\nfunction Chat() {\n  const [input, setInput] = useState(); //takes what msg user enters\n  const [messages, setMessages] = useState([]); //local state array for messages\n  const chatName = useSelector(selectChatName); //seclects chat name from chat slice\n  const chatId = useSelector(selectChatId); //selects chat Id from chat slice\n  const user = useSelector(selectUser);\n  let [emojiSwitch, setEmojiSwitch] = useState(false);\n\n  //only triggers when chatId changes\n  //for setting msg to database and listen\n  //for any changes in the messages state\n  useEffect(() => {\n    //if there is a chatID\n    //it will go to chats db which is previously created\n    //grab the chatId from chats db\n    //as we click on the chat room chatId changes and useEffect\n    //loads based on chatId changes\n    //it will create db based on chat id\n    //create message db and order it by timestamp desc\n    //then on any chages inside the message db\n    //it will store it message array state\n    //the id of the msg in db and data\n    if (chatId) {\n      db.collection(\"chats\")\n        .doc(chatId)\n        .collection(\"messages\")\n        .orderBy(\"timestamp\", \"desc\")\n        .onSnapshot((snapshot) => {\n          setMessages(\n            snapshot.docs.map((doc) => ({\n              id: doc.id,\n              data: doc.data(),\n            }))\n          );\n        });\n    }\n  }, [chatId]);\n\n  //fires in whenever user hits enter after typing a message\n  const sendMessage = (e) => {\n    e.preventDefault(); //prevents from reloading the page\n    //firebase works\n    //tells to go to the collection of chats in firebase db\n    //then go to based on current chatId\n    //for that particular chatId goto the db of messages\n    //then add column\n    db.collection(\"chats\").doc(chatId).collection(\"messages\").add({\n      //this provides the time of actual server where is no problem for different country time\n      timestamp: firebase.firestore?.FieldValue.serverTimestamp(),\n      message: input, //collected from input state\n      //all 4 below are colleted from user slice redux\n      uid: user.uid,\n      photo: user.photo,\n      displayName: user.displayName,\n      email: user.email,\n    });\n\n    setInput(\"\"); //set the input to nothing after sending message\n  };\n\n  //emoji api function\n  const addEmoji = (e) => {\n    let emoji = e.native;\n    setInput(input + emoji);\n  };\n\n  return (\n    <div className=\"chat\">\n      {/* for the chat header section */}\n      <div className=\"chat__header\">\n        <h4>\n          To: <span className=\"chat__channelName\">{chatName}</span>\n        </h4>\n        <strong>Details</strong>\n      </div>\n\n      {/* for chat messages section */}\n      <div className=\"chat__messages\">\n        <FlipMove className=\"chat__flipMove\">\n          {messages.map(({ id, data }) => (\n            <Message key={id} contents={data} />\n          ))}\n        </FlipMove>\n      </div>\n\n      {/* for the chat input section */}\n      <div className=\"chat__input\">\n        <form>\n          <input\n            value={input}\n            onChange={(e) => {\n              setInput(e.target.value);\n            }}\n            placeholder=\"iMessage\"\n            type=\"text\"\n          />\n          <button onClick={sendMessage}>Send Message</button>\n        </form>\n        <IconButton\n          onClick={() => {\n            setEmojiSwitch(!emojiSwitch);\n          }}\n        >\n          <InsertEmoticonIcon></InsertEmoticonIcon>\n        </IconButton>\n\n        {emojiSwitch ? (\n          <span className=\"chat__inputEmojiPicker\">\n            <Picker onSelect={addEmoji} />\n          </span>\n        ) : (\n          \"\"\n        )}\n\n        <IconButton>\n          <MicIcon className=\"chat__mic\" />\n        </IconButton>\n      </div>\n    </div>\n  );\n}\n\nexport default Chat;\n"]},"metadata":{},"sourceType":"module"}